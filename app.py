import streamlit as st
import requests

# –í–ê–ñ–ù–û: —Å—é–¥–∞ –≤—Å—Ç–∞–≤—å —Å–≤–æ—é —Ä–∞–±–æ—á—É—é —Å—Å—ã–ª–∫—É Google Apps Script /exec
SCRIPT_URL = "https://script.google.com/macros/s/AKfycb.../exec"

st.set_page_config(page_title="Idea.bkz", layout="centered")

st.title("Idea.bkz")
st.subheader("–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–∞–¥–∞–Ω–∏–π –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏")
st.caption("–ë–∏–æ–ª–æ–≥–∏—è, 7 –∫–ª–∞—Å—Å ‚Ä¢ –¢–µ–º–∞: –í—ã–¥–µ–ª–µ–Ω–∏–µ")
st.markdown("---")

st.header("üßë‚Äçüéì –î–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∞")
name = st.text_input("–§–ò–û —É—á–µ–Ω–∏–∫–∞", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–π–¥–∞–Ω–∞ –°.")
klass = st.text_input("–ö–ª–∞—Å—Å", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 7–ê")

st.markdown("---")
st.header("üìù –¢–µ—Å—Ç (10 –≤–æ–ø—Ä–æ—Å–æ–≤)")

q1 = st.radio("1) –ì–ª–∞–≤–Ω—ã–π –æ—Ä–≥–∞–Ω –≤—ã–¥–µ–ª–µ–Ω–∏—è —É —á–µ–ª–æ–≤–µ–∫–∞:", ["–ü–µ—á–µ–Ω—å", "–ü–æ—á–∫–∏", "–õ—ë–≥–∫–∏–µ"])
q2 = st.radio("2) –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –ø–æ—á–∫–∏:", ["–ê–ª—å–≤–µ–æ–ª–∞", "–ù–µ—Ñ—Ä–æ–Ω", "–ö–∞–ø–∏–ª–ª—è—Ä"])
q3 = st.radio("3) –ö –∫–∞–∫–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–æ—á–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π —ç—Ç–∞–ø):", ["–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è", "–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑", "–ë—Ä–æ–∂–µ–Ω–∏–µ"])
q4 = st.radio("4) –ß—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å –º–æ—á–æ–π?", ["–ö–∏—Å–ª–æ—Ä–æ–¥", "–õ–∏—à–Ω—è—è –≤–æ–¥–∞ –∏ –≤—Ä–µ–¥–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞", "–¢–æ–ª—å–∫–æ –≤–∏—Ç–∞–º–∏–Ω—ã"])
q5 = st.radio("5) –ö–∞–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω–æ–≤ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–µ?", ["–í—ã–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è", "–ù–µ—Ä–≤–Ω–∞—è", "–û–ø–æ—Ä–Ω–æ-–¥–≤–∏–≥–∞—Ç–µ–ª—å–Ω–∞—è"])
q6 = st.radio("6) –ß–µ—Ä–µ–∑ –∫–∞–∫–æ–π –æ—Ä–≥–∞–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è —É–≥–ª–µ–∫–∏—Å–ª—ã–π –≥–∞–∑?", ["–ü–æ—á–∫–∏", "–õ—ë–≥–∫–∏–µ", "–ö–æ—Å—Ç–∏"])
q7 = st.radio("7) –ö–∞–∫–æ–π –æ—Ä–≥–∞–Ω —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã–¥–µ–ª–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ –ø–æ—Ç?", ["–ö–æ–∂–∞", "–ñ–µ–ª—É–¥–æ–∫", "–°–µ—Ä–¥—Ü–µ"])
q8 = st.radio("8) –ü–æ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ–¥–µ—Ä–∂–∏—Ç:", ["–í–æ–¥—É –∏ —Å–æ–ª–∏", "–î–ù–ö", "–ñ–∏—Ä—ã"])
q9 = st.radio("9) –ú–æ—á–∞ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤:", ["–ü–µ—á–µ–Ω–∏", "–ù–µ—Ñ—Ä–æ–Ω–∞—Ö –ø–æ—á–µ–∫", "–õ—ë–≥–∫–∏—Ö"])
q10 = st.radio("10) –ü–æ—á–µ–º—É –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ?", ["–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–¥–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤", "–î–ª—è –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è", "–î–ª—è —Ä–æ—Å—Ç–∞ –∫–æ—Å—Ç–µ–π"])

answers = [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10]

# ‚úÖ –ö–ª—é—á –æ—Ç–≤–µ—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤—ã—à–µ)
correct = [
    "–ü–æ—á–∫–∏",
    "–ù–µ—Ñ—Ä–æ–Ω",
    "–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è",
    "–õ–∏—à–Ω—è—è –≤–æ–¥–∞ –∏ –≤—Ä–µ–¥–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞",
    "–í—ã–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è",
    "–õ—ë–≥–∫–∏–µ",
    "–ö–æ–∂–∞",
    "–í–æ–¥—É –∏ —Å–æ–ª–∏",
    "–ù–µ—Ñ—Ä–æ–Ω–∞—Ö –ø–æ—á–µ–∫",
    "–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–¥–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤"
]

st.markdown("---")

if st.button("üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã"):
    if not name.strip() or not klass.strip():
        st.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ –∫–ª–∞—Å—Å.")
        st.stop()

    # –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–∞ –∏–∑ 10
    score = sum(1 for i in range(10) if answers[i] == correct[i])

    # –ê–≤—Ç–æ-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—á–µ–Ω–∏–∫—É
    if score >= 9:
        comment = "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –¢—ã —Ö–æ—Ä–æ—à–æ –ø–æ–Ω—è–ª(–∞) —Ç–µ–º—É ¬´–í—ã–¥–µ–ª–µ–Ω–∏–µ¬ª. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ."
        level = "–í—ã—Å–æ–∫–∏–π"
    elif score >= 7:
        comment = "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ–≤—Ç–æ—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã: —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—á–µ–∫ –∏ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–æ—á–∏."
        level = "–•–æ—Ä–æ—à–∏–π"
    elif score >= 5:
        comment = "–¢–µ–º–∞ —É—Å–≤–æ–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å: –æ—Ä–≥–∞–Ω—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ –∏—Ö —Ä–æ–ª—å, –Ω–µ—Ñ—Ä–æ–Ω, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è."
        level = "–°—Ä–µ–¥–Ω–∏–π"
    else:
        comment = "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ–º—É ¬´–í—ã–¥–µ–ª–µ–Ω–∏–µ¬ª: –æ—Ä–≥–∞–Ω—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è, –Ω–µ—Ñ—Ä–æ–Ω –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –æ–±—Ä–∞—Ç–∏—Å—å –∫ —É—á–∏—Ç–µ–ª—é."
        level = "–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ"

    # –ü–æ–∫–∞–∑ —É—á–µ–Ω–∏–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    st.success(f"–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {score} –∏–∑ 10")
    st.info(f"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {comment}")

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google –¢–∞–±–ª–∏—Ü—É
    data = {
        "name": name.strip(),
        "klass": klass.strip(),

        "q1": q1, "q2": q2, "q3": q3, "q4": q4, "q5": q5,
        "q6": q6, "q7": q7, "q8": q8, "q9": q9, "q10": q10,

        "score": score,
        "level": level,
        "comment": comment
    }

    try:
        r = requests.post(SCRIPT_URL, json=data, timeout=20)
        if r.status_code == 200:
            st.success("‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ —É—á–∏—Ç–µ–ª—è.")
        else:
            st.warning(f"–û—Ç–≤–µ—Ç –ø–æ–∫–∞–∑–∞–Ω, –Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É –Ω–µ –∑–∞–ø–∏—Å–∞–ª—Å—è (–∫–æ–¥ {r.status_code}).")
            st.text(r.text[:400])
    except Exception as e:
        st.warning("–û—Ç–≤–µ—Ç –ø–æ–∫–∞–∑–∞–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É (–ø—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç/—Å—Å—ã–ª–∫—É Script).")
        st.text(str(e))
